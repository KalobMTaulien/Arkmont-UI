$(document).ready(function(){const a=$("body"),b={courseId:a.data("course-id")},c=a.attr("data-course-id-rev"),d=function(a,b){return void 0!==b&&"reset"!==b?a.html(b).addClass("account__error--visible"):a.removeClass("account__error--visible"),!1};$(".progress-bar[data-percent]").each(function(){$(this).css({width:$(this).data("percent")+"%"})});const e=function(){return $(".lesson--sortable").sortable({items:"li.draggable",dropOnEmpty:!1,cursor:"move",revert:!1,placeholder:"draggable--placeholder",cancel:"input",handle:".js-drag-lesson",axis:"y",opacity:.7,snap:!0,stop:function(a){const c=$(".lesson__number");b.lessons=[],$("li.lesson[data-lesson-id]").each(function(a){b.lessons.push({lessonId:$(this).data("data-lesson-id"),moduleId:$(this).closest("ul.sman__module").attr("data-module-id"),weight:a}),$(this).find(".lesson__number").text(a+1)}),$(this).sortable("refresh"),ajax("set-course-syllabus-order",b,function(){c.css("opacity",.3)},function(b){},function(){},function(){c.css("opacity",1)})},connectWith:".lesson--sortable",create:function(){$(this).sortable("refresh").sortable("refreshPositions")}})};$(".lesson--sortable").length&&e(),$(document).on("click",".course__otherpages",function(a){return!($(window).outerWidth(!0)<=540)||($(this).toggleClass("course__otherpages--opened"),a.preventDefault())}).on("submit",".js-change-details",function(a){a.preventDefault();const c=$(this),e=$("button",c),f=$(".js-error",c);return b.details={name:$.trim($('[name="course_name"]',c).val()),brief:$.trim($('[name="course_brief"]',c).val()),url:$.trim($('[name="course_url"]',c).val()),category:$.trim($('[name="course_category"]',c).val())},ajax("set-course-details",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved");for(let d in b)$(':input[name="course_'+d+'"]',c).val(b[d])},function(){e.button("reset")},function(){}),!1}).on("submit",".js-change-license",function(a){a.preventDefault();const c=$(this),e=$("button",c),f=$(".js-error",c);return b.license=$('[name="course_license"]',c).val(),ajax("set-course-license",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved"),$(':input[name="course_license"]',c).val(b.license)},function(){e.button("reset")},function(){}),!1}).on("submit",".js-change-price",function(a){a.preventDefault();const c=$(this),e=$("button",c),f=$(".js-error",c);if(b.price=parseFloat($('[name="course_price"]',c).val()).toFixed(2),b.price>0){if(b.price<9||b.price>=1e3)return d(f,"Course prices must be between $9 and $999.99")}else b.price=0;return ajax("set-course-price",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved"),$(':input[name="course_price"]',c).val(b.price)},function(){e.button("reset")},function(){}),!1}).on("click",".js-create-coupon",function(a){return $(this).hide(),$(".js-add-coupon").slideDown(300,function(){$("html, body").animate({scrollTop:$(this).offset().top-70},450,function(){$(':input[name="coupon_code"]').focus()})}),a.preventDefault()}).on("submit",".js-add-coupon",function(a){a.preventDefault();const c=$(this),e=$("button",c),f=$(".js-error",c);return b.coupon={price:parseFloat($('[name="coupon_price"]',c).val()).toFixed(2),totalCoupons:Number($('[name="coupon_total"]',c).val()),code:String($('[name="coupon_code"]',c).val()).toUpperCase()},b.coupon.price<5?d(f,"Coupon price must be $5 or more."):b.coupon.totalCoupons<1||b.coupon.totalCoupons>200?d(f,"You can create between 1 and 200 coupons at a time"):(ajax("set-course-coupon",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved");const d=$(".js-coupon-table");$(':input[name="course_price"]',c).val(b.price),$("tbody",d).append("<tr><td>"+b.code+"</td><td>$"+b.price.toFixed(2)+"</td><td>"+b.totalCoupons+'</td><td class="js-coupon-active">Yes</td><td class="text--right"><button class="btn btn--sm js-deactivate-coupon" data-coupon-id="'+b.id+'" data-action="confirm">Deactivate</button></td></tr>'),d.show()},function(){e.button("reset")},function(){}),!1)}).on("click",".js-deactivate-coupon",function(a){const c=$(this),d=c.attr("data-action");return"confirm"===d?(c.text("Are you sure?"),c.attr("data-action","deactivate")):(b.couponId=c.attr("data-coupon-id"),ajax("set-course-coupon-deactivate",b,function(){c.button()},function(){c.closest("tr").find(".js-coupon-active").text("No"),c.button("reset"),c.prop("disabled",!0).addClass("disabled").text("Inactive")},function(){c.button("reset")},function(){})),a.preventDefault()}).on("click",".js-report-review",function(a){const c=$(this),d=c.attr("data-action");return"confirm"===d?(c.text("Are you sure?"),c.attr("data-action","report")):(b.reportType=c.attr("data-report"),b.reviewId=Number(c.attr("data-review-id")),ajax("set-course-report-review",b,function(){c.button()},function(){c.button("reset"),c.closest(".review__actioncontainer").find("button").not(c).remove(),c.text("Report Filed").addClass("disabled").prop("disabled",!0)},function(){c.button("reset")},function(){})),a.preventDefault()}).on("click",".js-lesson-review",function(a){const c=$(this),d="false"!==c.attr("data-opened");if(!d){const a=$("span",c);b.lessonId=c.attr("data-lesson-id"),ajax("get-course-lesson-reviews",b,function(){a.button()},function(d){c.attr("data-opened","true");let e="";const f=b.lessonId+"-";for(i in d.keywords)e+='<div class="lr__item"><div class="lr__name">'+d.keywords[i].term+" ("+d.keywords[i].total+' reviews)</div><div class="lr__bar"><div class="progress"><div class="progress-wrapper"><div class="progress-bar" id="'+f+i+'">'+d.keywords[i].percent+"%</div></div></div></div></div>";c.after(e),setTimeout(function(){for(i in d.keywords)$("#"+f+i).css({width:d.keywords[i].percent+"%"})},200)},function(){},function(){a.button("reset")}),a.button()}return a.preventDefault()}).on("submit",".js-change-google-analytics",function(a){a.preventDefault();const c=$(this),e=$("button",c),f=$(".js-error",c);return b.trackingId=$('[name="course_ga"]',c).val(),ajax("set-course-google-analytics",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved"),$('[name="course_ga"]',c).val(b.trackingId)},function(){e.button("reset")},function(){}),!1}).on("click",".js-remove-teacher",function(a){const c=$(this),d=c.attr("data-action");return"confirm"===d?(c.text("Are you sure?"),c.attr("data-action","remove")):(b.teacherId=c.attr("data-teacher-id"),ajax("set-course-remove-teacher",b,function(){c.button()},function(){c.closest("tr").remove()},function(){c.button("reset")},function(){})),a.preventDefault()}).on("click",".js-show-teacher-form",function(a){return $(this).hide(),$(".js-add-teacher").slideDown(300,function(){$("html, body").animate({scrollTop:$(this).offset().top-70},450,function(){$(':input[name="teacher_email"]').focus()})}),a.preventDefault()}).on("submit",".js-add-teacher",function(a){a.preventDefault();const c=$(this),e=$("button",c),f=$(".js-error",c);return b.teacher={email:$('[name="teacher_email"]',c).val().toLowerCase(),earningPercent:Number($('[name="teacher_amount"]',c).val())},b.teacher.earningPercent>90?d(f,"Please enter a valid earning percent for this teacher."):(ajax("set-course-add-teacher",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved"),$(":input",c).val("");const d=$(".js-teacher-table");$("tbody",d).append("<tr><td>"+b.name+"</td><td>"+b.earningPercent+'%</td><td class="text--right"><button class="btn btn--sm js-remove-teacher" data-teacher-id="'+b.teacherId+'" data-action="confirm">Remove</button></td></tr>'),d.show(),$("html, body").animate({scrollTop:d.offset().top-70},450)},function(){e.button("reset")},function(){}),!1)}).on("click",".js-remove-teacher-assistant",function(a){const c=$(this),d=c.attr("data-action");return"confirm"===d?(c.text("Are you sure?"),c.attr("data-action","remove")):(b.teacherAssistantId=c.attr("data-teacher-assistant-id"),ajax("set-course-remove-teacher-assistant",b,function(){c.button()},function(){c.closest("tr").remove()},function(){c.button("reset")},function(){})),a.preventDefault()}).on("submit",".js-add-teacher-assistant",function(a){a.preventDefault();const c=$(this),e=$("button",c),f=$(".js-error",c);return b.teacherAssitantEmail=$('[name="ta_email"]',c).val().toLowerCase(),ajax("set-course-add-teacher-assistant",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved"),$(":input",c).val("");const d=$(".js-teacher-table");$("tbody",d).append("<tr><td>"+b.name+'</td><td class="text--right"><button class="btn btn--sm js-remove-teacher-assistant" data-teacher-assistant-id="'+b.studentId+'" data-action="confirm">Remove</button></td></tr>'),d.show(),$("html, body").animate({scrollTop:d.offset().top-70},450)},function(){e.button("reset")},function(){}),!1}).on("click",".js-student-details",function(a){const c=$(this),d="false"!==c.attr("data-opened");return d||(b.studentId=c.data("student-id"),c.attr("data-opened","true"),ajax("get-course-student-details",b,function(){},function(b){c.after('<tr class="no-hover"><td colspan="3"><div class="student__details"><label>Name:</label> '+b.name+'</div><div class="student__details"><label>Email:</label> '+b.email+'</div><div class="student__details"><label>Questions Asked:</label> '+b.totalQuestionsAsked+'</div><div class="student__details"><label>Comments Added:</label> '+b.totalCommentsProvided+"</div></td></tr>")},function(){c.attr("data-opened","false")},function(){})),a.preventDefault()}).on("submit",".js-create-announcement",function(a){a.preventDefault();const c=$(this),e=$('button[type="submit"]',c),f=$(".js-error",c);return b.announcement={title:$.trim($('[name="announcement_title"]',c).val()),body:$.trim($(".announcement-body").trumbowyg("html"))},b.announcement.title.length?b.announcement.body.length?(ajax("set-course-announcement",b,function(){d(f,"reset"),e.button()},function(b){window.location=b.announcement.url},function(){e.button("reset")},function(){}),!1):d(f,"Your announcement needs some content."):d(f,"Your announcement needs a title.")}).on("change",".js-select-intro-video",function(a){const d=$(".selected-file-name"),e=$(".js-select-intro-video")[0],f=e.files[0],g=$(".js-upload-percent"),h=$(".progress-bar");AWS.config.update({accessKeyId:"SAMPLE-KEY-HERE",secretAccessKey:"SAMPLE-ACCESS-KEY-HERE",region:"us-west-1"});const i=new AWS.S3({params:{Bucket:"arkmont"}});if(!f)return d.text(""),!1;if("video/mp4"!==f.type&&"video/avi"!==f.type&&"video/quicktime"!==f.type&&"video/x-ms-wmv"!==f.type)return d.text(""),!1;d.text(f.name);const j=f.name.replace(/[^a-zA-Z0-9-_.]/g,"-"),k={Key:"courses/"+c+"/intro/"+j,ContentType:f.type,Body:f,ACL:"private",CacheControl:"max-age=86400"};h.css("width","20%"),g.html("Starting upload...");const l=i.upload(k,function(a,c){a?(h.css("width",0),g.html('Upload failed <i class="fa fa-times"></i>'),$(".js-video-upload-form")[0].reset()):(b.fileLocation=c.Location,b.filename=j,ajax("set-course-intro-video",b,function(){g.html("Starting upload...")},function(b){g.html('Upload complete <i class="fa fa-check"></i>'),setTimeout(function(){location.reload()},3e3)},function(){$(".js-video-upload-form")[0].reset()},function(){g.html(""),h.css("width",0)}))});l.on("httpUploadProgress",function(a){const b=Math.floor(a.loaded/(100*a.total));g.html(b+"%"),b>20&&h.css("width",b+"%")})}).on("change",".js-select-cover-image",function(a){a.preventDefault();const b=$(this).closest("form"),c=$(".js-select-cover-image")[0],d=c.files[0];d&&b.submit()}).on("submit",".js-image-upload-form",function(a){a.preventDefault();const c=$(this),e=$(".selected-file-name"),f=$(".js-select-cover-image")[0],g=f.files[0],h=$(".js-upload-percent"),i=$(".progress-bar"),j=g.name.replace(/[^a-zA-Z0-9-_.]/g,"-"),k=$(".js-error",c);return""===j?(e.text(""),c.clearForm(),d(k,"reset")):"image/png"!==g.type&&"image/jpg"!==g.type&&"image/jpeg"!==g.type?(e.text(""),d(k,"Please select a .png or .jpg image.")):(d(k,"reset"),$(this).ajaxSubmit({data:b,type:"POST",url:"/ajax/set-course-cover-image.json",dataType:"json",beforeSend:function(){h.html("Starting upload...")},uploadProgress:function(a,b,c,d){h.html(d+"%"),d>20?i.css("width",d+"%"):d>=99&&(i.css("width","100%"),h.html("Compressing image..."))},complete:function(){c.clearForm()},success:function(a){$(".header__bg--0").css("background-image","url("+a.cover.small+")"),$(".js-current-image").attr("src",a.cover.large)},error:function(a){h.html(""),i.css("width",0)}}),!1)}).on("submit",".js-update-description",function(a){a.preventDefault();const c=$(this),e=$('button[type="submit"]',c),f=$(".js-error",c),g=$(".tmp:first",c);b.description=$.trim($(".description-body").trumbowyg("html")),g.html(b.description);const h=g.clone();$("*",h).removeAttr("class id style name onerror onclick ondblclick onmousedown onmouseover onmouseup onmousewheel oncopy oncut onpaste title disabled alt onload onkeyup onkeypress onkeydown"),g.html(h);const i=$.trim($(".tmp > div")[0].innerHTML),j=$(".tmp",c).text().split(" ").length;return j<200?d(f,"Every course must have at least 200 words to describe it."):(b.description=i,ajax("set-course-description",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved"),$(".description-body").trumbowyg("html",b.description)},function(){e.button("reset")},function(){}),!1)}).on("click",".js-remove-keyword",function(a){return $(this).remove(),$(".manager__keywordcontainer").find(".js-remove-keyword").length<10&&$(".js-add-keyword").removeClass("disabled").prop("disabled",!1),a.preventDefault()}).on("click",".js-add-keyword",function(a){return a.preventDefault(),$(".js-new-keyword").length||$(this).before(' <input type="text" placeholder="Add New Point" class="keyword keyword--add js-new-keyword" /> '),$(".js-new-keyword").focus(),!1}).on("keydown",".js-new-keyword",function(a){if(188===a.keyCode||13===a.keyCode){const b=$.trim(this.value.replace(/[^a-zA-Z0-9\s-_]/g," "));return b.length>0&&($(this).before(' <span class="keyword keyword--removable js-remove-keyword" data-keyword="'+b+'">'+b+"</span> "),this.value="",this.focus(),$(".manager__keywordcontainer").find(".js-remove-keyword").length>=10&&(this.remove(),$(".js-add-keyword").addClass("disabled").prop("disabled",!0))),a.preventDefault()}}).on("submit",".js-update-keywords",function(a){a.preventDefault();const c=$(this),e=$("button",c),f=$(".js-error",c);return b.keywords=[],$(".manager__keywordcontainer").find(".js-remove-keyword").each(function(){const a=$(this).attr("data-keyword");$.inArray(a,b.keywords)&&b.keywords.push(a)}),b.keywords.length?(ajax("set-course-keywords",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved"),$(".js-remove-keyword").remove();const c=$(".manager__keywordcontainer");for(let d in b.keywords)c.prepend(' <span class="keyword keyword--removable js-remove-keyword" data-keyword="'+b.keywords[d]+'">'+b.keywords[d]+"</span> ");b.keywords.length>=10&&($(".js-new-keyword").remove(),$(".js-add-keyword").addClass("disabled").prop("disabled",!0))},function(){e.button("reset")},function(){}),!1):d(f,"Please enter at least one value.s")}).on("submit",".js-update-requirements",function(a){a.preventDefault();const c=$(this),e=$("button",c),f=$(".js-error",c);return b.requirements=[],$(".manager__keywordcontainer").find(".js-remove-keyword").each(function(){const a=$(this).attr("data-keyword");$.inArray(a,b.requirements)&&b.requirements.push(a)}),b.requirements.length?(ajax("set-course-requirements",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved"),$(".js-remove-keyword").remove();const c=$(".manager__keywordcontainer");for(let d in b.requirements)c.prepend(' <span class="keyword keyword--removable js-remove-keyword" data-keyword="'+b.requirements[d]+'">'+b.requirements[d]+"</span> ");b.requirements.length>=10&&($(".js-new-keyword").remove(),$(".js-add-keyword").addClass("disabled").prop("disabled",!0))},function(){e.button("reset")},function(){}),!1):d(f,"Please enter at least one value.")}).on("submit",".js-update-skills",function(a){a.preventDefault();const c=$(this),e=$("button",c),f=$(".js-error",c);return b.skills=[],$(".manager__keywordcontainer").find(".js-remove-keyword").each(function(){const a=$(this).attr("data-keyword");$.inArray(a,b.skills)&&b.skills.push(a)}),b.skills.length?(ajax("set-course-skills",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved"),$(".js-remove-keyword").remove();const c=$(".manager__keywordcontainer");for(let d in b.skills)c.prepend(' <span class="keyword keyword--removable js-remove-keyword" data-keyword="'+b.skills[d]+'">'+b.skills[d]+"</span> ");b.skills.length>=10&&($(".js-new-keyword").remove(),$(".js-add-keyword").addClass("disabled").prop("disabled",!0))},function(){e.button("reset")},function(){}),!1):d(f,"Please enter at least one value.")}).on("click",".js-delete-course",function(a){const c=$(this),d=c.attr("data-action");"confirm"===d?(c.text("Are you sure?"),c.attr("data-action","remove")):ajax("set-course-remove",b,function(){c.button()},function(){window.location="/"},function(){c.button("reset")},function(){})}).on("click",".js-hide-course",function(a){const c=$(this),d=c.attr("data-action");"confirm"===d?(c.text("Are you sure?"),c.attr("data-action","delist")):ajax("set-course-hide",b,function(){c.button()},function(){location.reload()},function(){c.button("reset")},function(){})}).on("submit",".js-save-lesson-text",function(a){a.preventDefault();const c=$(this),e=$("button",c),f=$(".js-error",c);return b.title=$.trim($('[name="lesson_title"]',c).val()),b.description=$.trim($('[name="lesson_description"]',c).val()),b.lessonId=$(this).closest(".lesson").attr("data-lesson-id"),ajax("set-course-lesson-text",b,function(){d(f,"reset"),e.button()},function(b){e.button("saved");for(let d in b)$(':input[name="lesson_'+d+'"]',c).val(b[d])},function(){e.button("reset")},function(){}),!1}).on("click",".js-upload-video",function(a){const b=$(this).closest(".lesson");return b.find(".js-video-selector").trigger("click"),a.preventDefault()}).on("change",".js-video-selector, .js-file-selector",function(a){return $(this).closest("form").trigger("submit"),a.preventDefault()}).on("submit",".js-upload-video-form",function(a){a.preventDefault();const e=$(this).closest(".lesson"),f=e.attr("data-lesson-id"),g=$(".js-video-name",e),h=$(".js-video-selector",e)[0],i=h.files[0],j=$(".js-video-upload-progress",e),k=$(".js-upload-video",e),l=$(".js-video-error",e);AWS.config.update({accessKeyId:"SAMPLE-KEY-HERE",secretAccessKey:"SAMPLE-ACCESS-KEY-HERE",region:"us-west-1"});const m=new AWS.S3({params:{Bucket:"arkmont"}});if(!i)return g.text(""),d(l,"reset");if("video/mp4"!==i.type&&"video/avi"!==i.type&&"video/quicktime"!==i.type&&"video/x-ms-wmv"!==i.type)return g.text(""),d(l,"Please select an .avi, .mp4, .wmv or .mov video file.");if(i.size>5e8)return g.text(""),d(l,"Your video is too large. It should be less than 500mb and less than 30 minutes.");g.text(i.name);const n=i.name.replace(/[^a-zA-Z0-9-_.]/g,"-"),o=f.split("").reverse().join(""),p={Key:"courses/"+c+"/lessons/"+o+"/"+n,ContentType:i.type,Body:i,ACL:"private",CacheControl:"max-age=86400"};j.text(""),d(l,"reset"),k.button();const q=m.upload(p,function(a,c){a?(j.text(""),$(".js-upload-video-form")[0].reset(),g.text(""),k.button("reset"),d(l,"There was a problem uploading your video.")):(b.fileLocation=c.Location,b.filename=n,b.lessonId=f,ajax("set-course-lesson-video",b,function(){j.text("Saving...")},function(b){j.html('Upload complete <i class="fa fa-check"></i>'),setTimeout(function(){j.html(""),g.text("")},8e3)},function(){$(".js-upload-video-form")[0].reset(),j.html(""),g.text(""),$(".js-video-file-name",e).text(b.filename),$(".js-video-length",e).text("Calculating..."),d(l,"There was a problem saving your video.")},function(){k.button("reset")}))});return q.on("httpUploadProgress",function(a){const b=Math.floor(a.loaded/(100*a.total));j.text(b+"%")}),!1}).on("click",".js-upload-file",function(a){const b=$(this).closest(".lesson");return b.find(".js-file-selector").trigger("click"),a.preventDefault()}).on("submit",".js-upload-extra-form",function(a){a.preventDefault();const e=$(this).closest(".lesson"),f=e.attr("data-lesson-id"),g=$(".js-file-selector",e)[0],h=g.files[0],i=$(".js-upload-file",e),j=$(".js-video-error",e);AWS.config.update({accessKeyId:"SAMPLE-KEY-HERE",secretAccessKey:"SAMPLE-ACCESS-KEY-HERE",region:"us-west-1"});const k=new AWS.S3({params:{Bucket:"arkmont"}});if(!h)return d(j,"reset");if(h.size>157286400)return d(j,"Your file is too large. It should be less than 150mb.");const l=h.name.replace(/[^a-zA-Z0-9-_.]/g,"-"),m=f.split("").reverse().join(""),n={Key:"courses/"+c+"/lessons/"+m+"/files/"+l,ContentType:h.type,Body:h,ACL:"public-read"};d(j,"reset"),i.button();const o=k.upload(n,function(a,c){a?($(".js-upload-extra-form")[0].reset(),i.button("reset"),d(j,"There was a problem uploading your file.")):(b.location=c.Location,b.filename=l,b.lessonId=f,ajax("set-course-lesson-file",b,function(){},function(b){i.button("saved"),$(".lessonfiles",e).append('<li><a href="#" class="lessonfile" data-file-id="'+b.id+'"> <i class="fa fa-file-o"></i> '+b.filename+"</a></li>")},function(){$(".js-upload-extra-form")[0].reset(),d(j,"There was a problem saving your file."),i.button("reset")},function(){}))});return o.on("httpUploadProgress",function(a){}),!1}).on("click",".js-delete-lesson",function(a){const c=$(this),d=c.attr("data-action"),e=c.closest(".lesson");return"confirm"===d?(c.text("Are you sure?"),c.attr("data-action","remove")):(b.lessonId=e.attr("data-lesson-id"),ajax("set-course-lesson-remove",b,function(){c.button()},function(){$(".lesson__content",e).slideUp(function(){e.fadeOut(function(){$(this).remove()})})},function(){c.button("reset")},function(){})),a.preventDefault()}).on("change",".js-publish-lesson",function(a){const c=$(this).closest(".lesson"),d=$(this);return b.lessonId=c.attr("data-lesson-id"),b.published=this.checked?"1":"0",ajax("set-course-lesson-published",b,function(){},function(b){const e=$(".lesson__published",c);d.prop("checked",b.published),b.published?(e.text("(Published)"),c.removeClass("lesson--unpublished")):(e.text("(Unpublished)"),c.addClass("lesson--unpublished"))},function(){},function(){}),a.preventDefault()}).on("change",".js-free-preview",function(a){const c=$(this).closest(".lesson"),d=$(this);return b.lessonId=c.attr("data-lesson-id"),b.preview=this.checked?"1":"0",ajax("set-course-lesson-preview",b,function(){},function(b){d.prop("checked",b.preview)},function(){},function(){}),a.preventDefault()}).on("click",".lessonfile",function(a){const c=$(this),d=c.closest("li");b.fileId=c.attr("data-file-id");const e=$.trim(c.text()),f=new Modal({title:e,size:"small",message:"Would you like to delete this file?",buttons:{cancel:{label:"Cancel"},delete:{label:"Delete File",className:"js-delete-file",callback:function(){const a=$(".js-delete-file");return ajax("set-course-lesson-file-delete",b,function(){a.button()},function(){f.closeModal(),d.slideUp(function(){d.remove()})},function(){a.button("reset")},function(){}),!1}}}});return a.preventDefault()}).on("click",".js-add-question",function(a){const c=$(this),e=c.closest(".lesson");let f="";for(let g=1;g<=4;g++)f+='<tr class="no-hover question-option"><td class="text--center"><input type="checkbox" class="question-option-checkbox" /></td><td><textarea class="question-option-answer account__input" maxlength="500" rows="2" placeholder="Add an answer here. Leave blank for no answer."></textarea></td></tr>';const h=new Modal({title:"Add In-Lesson Question",message:'<p>In-lesson Questions will stop a video and ask the student a question. They are multiple choice with one or more correct answers.</p><label class="label label--full">Time in video (minutes)</label><input type="number" placeholder="1" class="account__input" id="minute" min="0" max="60" /><label class="label label--full">Time in video (seconds)</label><input type="number" placeholder="15" class="account__input" id="second" min="0" max="59" /><label class="label label--full">Question</label><textarea class="account__input" id="question-box" maxlength="2000" rows="2" placeholder="Which is the..."></textarea><table class="table table--nopadding" cellpadding="0" cellspacing="0"><thead><tr><th width="20%" class="text--center">Is Correct</th><th>Answer Text</th></tr></thead><tbody>'+f+'</tbody></table><p class="account__error js-error" id="question-error"></p>',buttons:{cancel:{label:"Cancel"},save:{label:"Add Question",className:"js-add-invideo-question",callback:function(){const a=$(".js-add-invideo-question");let c=Number($("#minute").val()),f=Number($("#second").val());const g=$("#question-error");let i=!1;return isNaN(c)?c=0:c>60?c=60:c<0&&(c=0),isNaN(f)?f=0:f>59?f=59:f<0&&(f=0),b.time=60*c+f,b.question=$.trim($("#question-box").val()),b.lessonId=e.attr("data-lesson-id"),b.answers=[],$(".question-option").each(function(){const a=$.trim($(".question-option-answer",this).val());if(null!==a&&a.length>0){const c={answer:a.substr(0,500),correct:$(".question-option-checkbox",this).is(":checked")};c.correct===!0&&(i=!0),b.answers.push(c)}}),0===b.time?d(g,"Enter the time (minutes and seconds) that the question should be asked at."):0===b.question.length?d(g,"Please enter a question"):b.answers.length<2?d(g,"Every question must have at least two answers"):i?(b.question=b.question.substr(0,2e3),d(g,"reset"),ajax("set-course-lesson-question",b,function(){a.button()},function(b){const c='<li><a href="#" class="lq__question js-edit-question" data-question-id="'+b.question.id+'">'+b.question.text+"</a></li>";e.find(".lessonquestions").prepend(c),h.closeModal()},function(){d(g,"There was a problem saving your question. Please try again."),a.button("reset")},function(){}),!1):d(g,"You must have at least one correct answer")}}}});return a.preventDefault()}).on("click",".js-edit-question",function(a){$(this);let e=$(this);e.closest(".lesson");let g="";return b.questionId=e.attr("data-question-id"),ajax("get-course-question-answers",b,function(){e.button()},function(c){e.button("reset");for(let f in c.answers)g+='<tr class="no-hover question-option" data-answer-id="'+c.answers[f].id+'"><td class="text--center"><input type="checkbox" class="question-option-checkbox" '+(c.answers[f].correct?" checked='checked'":"")+' /></td><td><textarea class="question-option-answer account__input" maxlength="500" rows="2" placeholder="Add an answer here. Leave blank for no answer.">'+c.answers[f].answer+"</textarea></td></tr>";for(let f=1;f<=4-c.answers.length;f++)g+='<tr class="no-hover question-option"><td class="text--center"><input type="checkbox" class="question-option-checkbox" /></td><td><textarea class="question-option-answer account__input" maxlength="500" rows="2" placeholder="Add an answer here. Leave blank for no answer."></textarea></td></tr>';const h=new Modal({title:"Add In-Lesson Question",message:'<p>In-lesson Questions will stop a video and ask the student a question. They are multiple choice with one or more correct answers.</p><label class="label label--full">Time in video (minutes)</label><input type="number" placeholder="1" class="account__input" id="minute"  min="0" max="60" value="'+c.minutes+'" /><label class="label label--full">Time in video (seconds)</label><input type="number" placeholder="15" class="account__input" id="second" min="0" max="59"  value="'+c.seconds+'" /><label class="label label--full">Question</label><textarea class="account__input" id="question-box" maxlength="2000" rows="2" placeholder="Which is the...">'+c.question+'</textarea><table class="table table--nopadding" cellpadding="0" cellspacing="0"><thead><tr><th width="20%" class="text--center">Is Correct</th><th>Answer Text</th></tr></thead><tbody>'+g+'</tbody></table><p class="account__error js-error" id="question-error"></p>',buttons:{cancel:{label:"Cancel"},save:{label:"Save Question",className:"js-edit-question",callback:function(){const a=$(".js-edit-question");let c=Number($("#minute").val()),f=Number($("#second").val());const g=$("#question-error");let i=!1;return isNaN(c)?c=0:c>60?c=60:c<0&&(c=0),isNaN(f)?f=0:f>59?f=59:f<0&&(f=0),b.time=60*c+f,b.question=$.trim($("#question-box").val()),b.answers=[],$(".question-option").each(function(){const a=$.trim($(".question-option-answer",this).val());let c={};null!==a&&a.length>0?(c={answer:a.substr(0,500),correct:$(".question-option-checkbox",this).is(":checked")},void 0!==$(this).attr("data-answer-id")&&(c.answerId=$(this).attr("data-answer-id")),c.correct===!0&&(i=!0)):void 0!==$(this).attr("data-answer-id")&&a.length<=0&&(c={removeMe:!0,answerId:$(this).attr("data-answer-id")}),b.answers.push(c)}),0===b.time?d(g,"Enter the time (minutes and seconds) that the question should be asked at."):0===b.question.length?d(g,"Please enter a question"):b.answers.length<2?d(g,"Every question must have at least two answers"):i?(b.question=b.question.substr(0,2e3),d(g,"reset"),ajax("set-course-lesson-question-edited",b,function(){a.button()},function(b){e.closest("li").html('<a href="#" class="lq__question js-edit-question" data-question-id="'+b.id+'">'+b.question+"</a>"),h.closeModal()},function(){d(g,"There was a problem editing your question.")},function(){a.button("reset")}),!1):d(g,"You must have at least one correct answer")}},delete:{label:"Delete Question",className:"js-delete-question",callback:function(){const a=$(".js-delete-question");return ajax("set-course-lesson-question-delete",b,function(){a.button()},function(b){h.closeModal(),$('.js-edit-question[data-question-id="'+b.id+'"]').closest("li").slideUp(function(){$(this).remove()})},function(){},function(){a.button("reset")}),!1}}}})},function(){},function(){e.button("reset")}),a.preventDefault()}).on("submit",".js-save-lesson-body",function(a){a.preventDdefault();const c=$(this),d=c.closest(".lesson"),e=$('button[type="submit"]',c);return b.lessonId=d.attr("data-lesson-id"),b.body=$.trim($(".js-wysiwyg",d).trumbowyg("html")),ajax("set-course-lesson-document-body",b,function(){e.button()},function(b){e.button("saved"),$(".js-wysiwyg",d).trumbowyg("html",b.body)},function(){e.button("reset")},function(){}),!1}).on("click",".js-edit-quiz-question",function(a){const c=$(this),e=c.closest(".lesson");let f="";return b.lessonId=e.attr("data-lesson-id"),b.questionId=c.attr("data-quiz-question-id"),ajax("get-course-lesson-quiz-answers",b,function(){c.button()},function(e){c.button("reset");for(let g in e.answers)f+='<tr class="no-hover question-option" data-answer-id="'+e.answers[g].id+'"><td class="text--center"><input type="checkbox" class="question-option-checkbox" '+(e.answers[g].correct?" checked='checked'":"")+' /></td><td><textarea class="question-option-answer account__input" maxlength="500" rows="2" placeholder="Add an answer here. Leave blank for no answer.">'+e.answers[g].answer+"</textarea></td></tr>";for(let g=1;g<=4-e.answers.length;g++)f+='<tr class="no-hover question-option"><td class="text--center"><input type="checkbox" class="question-option-checkbox" /></td><td><textarea class="question-option-answer account__input" maxlength="500" rows="2" placeholder="Add an answer here. Leave blank for no answer."></textarea></td></tr>';const h=new Modal({title:"Edit Quiz Question",message:'<label class="label label--full">Question</label><textarea class="account__input" id="question-box" maxlength="2000" rows="2" placeholder="Which is the...">'+e.question+'</textarea><table class="table table--nopadding" cellpadding="0" cellspacing="0"><thead><tr><th width="20%" class="text--center">Is Correct</th><th>Answer Text</th></tr></thead><tbody>'+f+'</tbody></table><p class="account__error js-error" id="question-error"></p>',buttons:{cancel:{label:"Cancel"},save:{label:"Save Question",className:"js-edit-quiz-question-confirmed",callback:function(){const a=$(".js-edit-quiz-question-confirmed"),e=$("#question-error");let f=!1;return b.question=$.trim($("#question-box").val()),b.answers=[],$(".question-option").each(function(){const a=$.trim($(".question-option-answer",this).val());let c={};null!==a&&a.length>0?(c={
answer:a.substr(0,500),correct:$(".question-option-checkbox",this).is(":checked")},void 0!==$(this).attr("data-answer-id")&&(c.answerId=$(this).attr("data-answer-id")),c.correct===!0&&(f=!0)):void 0!==$(this).attr("data-answer-id")&&a.length<=0&&(c={removeMe:!0,answerId:$(this).attr("data-answer-id")}),b.answers.push(c)}),f?(b.question=b.question.substr(0,2e3),d(e,"reset"),ajax("set-course-lesson-quiz-question-edited",b,function(){a.button()},function(b){c.closest("li").html('<a href="#" class="lq__question js-edit-quiz-question" data-quiz-question-id="'+b.id+'">'+b.question+"</a>"),h.closeModal()},function(){d(e,"There was a problem editing your question.")},function(){a.button("reset")}),!1):d(e,"You must have at least one correct answer")}},delete:{label:"Delete Question",className:"js-delete-question",callback:function(){const a=$(".js-delete-question");return ajax("set-course-lesson-question-delete",b,function(){a.button()},function(b){h.closeModal(),$('.js-edit-quiz-question[data-quiz-question-id="'+b.id+'"]').closest("li").slideUp(function(){$(this).remove()})},function(){},function(){a.button("reset")}),!1}}}})},function(){},function(){c.button("reset")}),a.preventDefault()}).on("click",".js-add-quiz-question",function(a){const c=$(this),e=c.closest(".lesson");let f="";for(let g=1;g<=4;g++)f+='<tr class="no-hover question-option"><td class="text--center"><input type="checkbox" class="question-option-checkbox" /></td><td><textarea class="question-option-answer account__input" maxlength="500" rows="2" placeholder="Add an answer here. Leave blank for no answer."></textarea></td></tr>';const h=new Modal({title:"Add Quiz Question",message:'<label class="label label--full">Question</label><textarea class="account__input" id="question-box" maxlength="2000" rows="2" placeholder="Which is the..."></textarea><table class="table table--nopadding" cellpadding="0" cellspacing="0"><thead><tr><th width="20%" class="text--center">Is Correct</th><th>Answer Text</th></tr></thead><tbody>'+f+'</tbody></table><p class="account__error js-error" id="question-error"></p>',buttons:{cancel:{label:"Cancel"},save:{label:"Add Question",className:"js-add-new-quiz-question",callback:function(){const a=$(".js-add-new-quiz-question"),c=$("#question-error");let f=!1;return b.question=$.trim($("#question-box").val()),b.lessonId=e.attr("data-lesson-id"),b.answers=[],$(".question-option").each(function(){const a=$.trim($(".question-option-answer",this).val());if(null!==a&&a.length>0){const c={answer:a.substr(0,500),correct:$(".question-option-checkbox",this).is(":checked")};c.correct===!0&&(f=!0),b.answers.push(c)}}),f?(b.question=b.question.substr(0,2e3),d(c,"reset"),ajax("set-course-lesson-quiz-question",b,function(){a.button()},function(b){const c='<li><a href="#" class="lq__question js-edit-quiz-question" data-quiz-question-id="'+b.question.id+'">'+b.question.text+"</a></li>";e.find(".lessonquestions").prepend(c),h.closeModal()},function(){d(c,"There was a problem saving your question. Please try again."),a.button("reset")},function(){}),!1):d(c,"You must have at least one correct answer")}}}});return a.preventDefault()}).on("click",".js-open-lesson",function(a){const c=$(this),d=c.text(),e=c.closest(".lesson"),g="false"!==e.attr("data-opened");return b.lessonId=e.attr("data-lesson-id"),g||ajax("get-course-lesson",b,function(){c.text("Loading...")},function(b){f(e,b)},function(){},function(){c.text(d)}),a.preventDefault()}).on("click",".js-add-lesson",function(a){const c=$(this),d=c.closest(".lesson"),f=new Modal({title:"New Lesson",message:'<label class="label label--full">Lesson Name</label><form><input class="account__input" id="lesson-name-box" maxlength="250" placeholder="What is the name of this lesson?" type="text"> <label class="label label--full">Lesson Type</label></form><div class="p-t-b-10"><label><input checked="checked" name="lesson-type" type="radio" value="video"> Video</label></div><div class="p-t-b-10"><label><input name="lesson-type" type="radio" value="document"> Reading Material (document)</label></div><div class="p-t-b-10"><label><input name="lesson-type" type="radio" value="quiz"> Quiz/Test</label></div>',size:"small",buttons:{addLesson:{label:"Add Lesson",className:"js-create-lesson",callback:function(){const a=$(".js-create-lesson");return b.name=$.trim($("#lesson-name-box").val()),b.lesson_type=$('input[name="lesson-type"]:checked').val(),""===b.name?($("#lesson-name-box").focus(),!1):(ajax("set-course-lesson-create",b,function(){a.button()},function(b){const c='<li class="lesson draggable" data-lesson-id="'+b.lesson.id+'" data-opened="false"><span class="lesson__number">'+($("li.lesson.draggable").length+1)+'</span><a href="#open-lesson" class="js-open-lesson lesson__open">'+b.lesson.name+'</a>  <span class="lesson__published">(Unpublished)</span><i class="fa fa-arrows lesson__drag js-drag-lesson"></i></li>';d.before(c),setTimeout(function(){e(),$(".lesson[data-lesson-id='"+b.lesson.id+"'] .js-open-lesson").click()},50),$("li.lesson[data-lesson-id]").each(function(a){$(this).find(".lesson__number").text(a+1)}),f.closeModal()},function(){a.button("reset")},function(){}),!1)}},cancel:{label:"Cancel",className:"btn-link pull-left"}}});return a.preventDefault()}).on("click",".js-add-module",function(a){const c=$(this),d=c.closest(".sman__module");b.weight=$(".sman__module[data-module-id]").length+1;const f=new Modal({title:"Add Module",message:'<label class="label label--full">Module Name*</label><input class="account__input" id="module-name-box" maxlength="100" placeholder="Module Name" type="text" />',size:"small",buttons:{cancel:{label:"Cancel"},save:{label:"Add Module",className:"js-create-module",callback:function(){const a=$(".js-create-module");return b.name=$.trim($("#module-name-box").val().substr(0,100)),b.description=null,""===b.name?($("#module-name-box").focus(),!1):(ajax("set-course-module-create",b,function(){a.button()},function(c){f.closeModal();const g='<ul class="sman__module" data-module-id="'+c.module.id+'"><li class="sman__modulename"><span class="sman__modulenumber">'+b.weight+"</span> "+c.module.name+'</li><li><ul class="lessons lesson--sortable"><li class="lesson lesson--add"><a href="#new-lesson" class="js-add-lesson"><i class="fa fa-plus"></i> Add New Lesson</a></li></ul></li></ul>';d.before(g),e()},function(c){a.button("reset")},function(){}),!1)}}}});return a.preventDefault()});const f=function(a,b){let c="",d="",e="",f="",g="";for(let h in b.files)c+='<li><a href="/" class="lessonfile" data-file-id="'+b.files[h].id+'"><i class="fa fa-file-o"></i> '+b.files[h].name+"</a></li>";if(g+='<form class="js-save-lesson-text"><label class="label">Lesson Title</label><input type="text" required="required" name="lesson_title" class="account__input" placeholder="Lesson Title" value="'+b.lesson.title+'" /><label class="label">Description</label><textarea name="lesson_description" rows="2" class="account__input">'+b.lesson.description+'</textarea><div class="account__error js-error"></div><button type="submit" class="btn btn--sm">Save</button></form>',"video"===b.lesson.type){for(let a in b.lesson.video.questions)e+='<li><a href="#" class="lq__question js-edit-question" data-question-id=" '+b.lesson.video.questions[a].id+'">'+b.lesson.video.questions[a].question+"</a></li>";f+='<div class="lesson__content"><div class="lesson__forms"><form class="lf__video js-upload-video-form"><input type="file" class="js-video-selector" accept=".mp4" /></form><form class="lf__video js-upload-extra-form"><input type="file" class="js-file-selector" /></form></div><div class="lesson__box"><div class="boxes"><div class="box--70" style="padding-right: 10px;"><h4 class="lesson__boxtitle">Video Details</h4><div class="lesson__detail">Video name: <span class="js-video-file-name">'+b.lesson.video.filename+'</span></div><div class="lesson__detail">Video length: <span class="js-video-length">'+b.lesson.video.time+'</span></div><div class="lesson__detail"><button class="btn js-upload-video">Upload New Video</button><span class="js-video-upload-progress"></span><span class="js-video-name"></span><div class="account__error js-video-error"></div></div></div><div class="box--30 hidden--lg"><img src="'+b.cover+'" style="width: 100%;" /></div></div></div><div class="boxes"><div class="box--70 lesson__box">'+g+'</div><div class="box--30 lesson__box"><label class="label label--full">Additional Files</label><ul class="lessonfiles">'+c+'</ul><a href="/" class="btn btn--sm js-upload-file">Upload Supplemental File</a></div></div><div class="boxes"><div class="box--70 lesson__box"><form ><label class="label">In-Video Questions</label><ul class="lessonquestions">'+e+'<li><a href="#" class="btn btn--sm js-add-quiz-question"><i class="fa fa-plus"></i> Add new question</a></li></ul><div class="account__error js-error"></div></form></div><div class="box--30 lesson__box"><label class="label label--full">Lesson Settings</label><ul class="lessonfiles"><li><label><input type="checkbox" class="js-publish-lesson" '+(b.lesson.published?' checked="checked" ':"")+' /> Lesson Published</label></li><li><label><input type="checkbox" class="js-free-preview" '+(b.lesson.freePreview?' checked="checked" ':"")+'/> Free Preview</label></li><li><label class="text--red"><a href="#" class="btn btn--text btn--danger js-delete-lesson" data-action="confirm"><i class="fa fa-times fa-fw"></i> Delete Lesson</a></label></li></ul></div></div></div>'}else if("document"===b.lesson.type)f+='<div class="lesson__content"><div class="lesson__forms"><form class="lf__video js-upload-extra-form"><input type="file" class="js-file-selector" /></form></div><div class="boxes"><div class="box--70 lesson__box">'+g+'<div class="account__error js-video-error"></div></div><div class="box--30 lesson__box"><label class="label label--full">Additional Files</label><ul class="lessonfiles">'+c+'</ul><a href="/" class="btn btn--sm js-upload-file">Upload Supplemental File</a></div></div><div class="boxes"><div class="box--70 lesson__box"><form class="js-save-lesson-body"><label class="label">Document Body</label><textarea class="account__input js-wysiwyg" name="body" rows="2" placeholder="Add your document content">'+b.lesson.document.body+'</textarea><div class="account__error js-error"></div><button type="submit" class="btn btn--sm">Save Document</button></form></div><div class="box--30 lesson__box"><label class="label label--full">Lesson Settings</label><ul class="lessonfiles"><li><label><input type="checkbox" class="js-publish-lesson" '+(b.lesson.published?' checked="checked" ':"")+' /> Lesson Published</label></li><li><label class="text--red"><a href="#" class="btn btn--text btn--danger js-delete-lesson" data-action="confirm"><i class="fa fa-times fa-fw"></i> Delete Lesson</a></label></li></ul></div></div></div>';else if("quiz"===b.lesson.type){for(let a in b.lesson.quiz.questions)d+='<li><a href="#" class="lq__question js-edit-quiz-question" data-quiz-question-id="'+b.lesson.quiz.questions[a].id+'">'+b.lesson.quiz.questions[a].question+"</a></li>";f+='<div class="lesson__content"><div class="lesson__forms"><form class="lf__video js-upload-extra-form"><input type="file" class="js-file-selector" /></form></div><div class="boxes"><div class="box--70 lesson__box">'+g+'</div><div class="box--30 lesson__box"><label class="label label--full">Lesson Settings</label><ul class="lessonfiles"><li><label><input type="checkbox" class="js-publish-lesson" '+(b.lesson.published?' checked="checked" ':"")+' /> Lesson Published</label></li><li><label class="text--red"><a href="#" class="btn btn--text btn--danger js-delete-lesson" data-action="confirm"><i class="fa fa-times fa-fw"></i> Delete Lesson</a></label></li></ul></div></div><div class="boxes"><div class="box lesson__box"><form class="js-save-lesson-body"><label class="label">Questions <span class="js-total-quiz-questions"></span></label><ul class="lessonquestions">'+d+'<li><a href="#" class="btn btn--sm js-add-quiz-question"><i class="fa fa-plus"></i> Add new question</a></li></ul><div class="account__error js-error"></div></form></div></div></div>'}a.append(f),a.attr("data-opened",!0),b.lesson.published?a.addClass("lesson--active").find(".lesson__published").text("(Published)"):a.addClass("lesson--unpublished lesson--active").find(".lesson__published").text("(Unpublished)"),a.find(".js-wysiwyg").trumbowyg({btns:[["h3","h4"],["strong","em","underline"],["link"],"btnGrp-lists",["removeformat"]],removeformatPasted:!0,autogrow:!0})}});
